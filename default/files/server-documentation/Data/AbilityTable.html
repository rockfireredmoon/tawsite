<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Reference: AbilityTable.txt</title>
<link rel="stylesheet" type="text/css" href="../main.css">
</head>
<body>

<div>

<h2>Reference: AbilityTable.txt</h2>

<div class="spacer"></div>
<h3>Purpose</h3>
Contains all the player and NPC abilities.  <b>Note that this file controls server-side operation only.  Changes to this file will not change anything in the client (like the descriptions or tooltips).</b>
<p>
To modify the client, this table must be converted into a Squirrel script.
<p>
Note: A separate file, AbilityTableAdmin.txt, holds extra abilities for administrative use.  They are not exposed to the client, but can be activated on the server side.  This is merely an organizational thing, it doesn't matter if they're included into the official table or client.

<div class="spacer"></div>
<h3>Contents</h3>
<a href="#ClientMod">Client Modding</a> -- How to mod the client's ability table.<br>
<a href="#EventTypes">Event Types</a> -- Ability event types.<br>
<a href="#TargetTypes">Target Types</a> -- Ability target types.<br>
<a href="#TargetFilter">Target Status Filters</a> -- Ability target status filters.<br>
<a href="#AbilityFunctions">Ability Functions</a> -- Documentation of all ability condition and action functions.<br>
<a href="#OtherNotes">Other Notes</a> -- Things to keep in mind if you're serious about ability modding.<br>
<a href="#Evaluations">Evaluations</a> -- How evaluations and variables in ability functions work.<br>

<div class="spacer"></div>
<a name="ClientMod"></a>
<h3>Modifying The Client's Ability Table</h3>
<b>AbilityTable.txt</b> must be converted into a Squirrel script file, which later must be compiled and archived.
<p>
For the purposes of conversion, the table must be limited to <b>exactly 28 columns wide</b>.  Extra columns are used by the server but should not be included in the client.
<p>
The Squirrel table should look something like the following example, taken from the first two lines.  This essentially creates an array of arrays.  The main array holds each ability entry.  The individual array for each ability entries contain 28 strings holding the first 28 columns of the table.
<p>
Each string must be enclosed in double quotation marks (ASCII character code 34), even if the string is empty.  All text must be ASCII-style characters only, below character code 127.  Higher codes such as accented characters or fancier Unicode-style opening/closing double quotes (often auto generated by modern word-processors and spreadsheet programs) may crash the client or prevent the script from being compiled or loaded correctly.
<p>
<span class="script">
AbilityIndex <- [

["1","Two Hand Weapons","0","0","","0","0","","0","","onActivate:Self:Status(CAN_USE_WEAPON_2H,-1)","","1","1,,0,(),K","Icon-32-Ability-W_2H_Weapons.png|Icon-32-BG-Black.png","Allows the use of Two Hand Weapons.","Weapon","0","1","1","Passive","4","0","0","2","0","",""],
["2","One Hand Weapons","0","0","","0","0","","0","","onActivate:Self:Status(CAN_USE_WEAPON_1H,-1)","","1","1,,0,(),KRD","Icon-32-Ability-W_1H_Weapons.png|Icon-32-BG-Black.png","Allows the use of One Hand Weapons.","Weapon","0","3","2","Passive","4","0","0","2","0","",""],

];
</span>
<p>
Included in the utility programs is <b>EEUtilAbilityTable.exe</b> (Windows only, but if necessary you can make your own converter).  Copy the utility to the same folder with <b>AbilityTable.txt</b>, or copy the ability table to the folder you're running the utility from.  It will load <b>AbilityTable.txt</b> from the same folder the utility is launched from, generating a new file <b>AbilityTable.nut</b>.  Then run the following command line operation to compile the Squirrel table:
<span class="script">
sq.exe -o Abilities.cnut -c AbilityTable.nut
</span>
<p>
Ensure the Squirrel compiler did not encounter any errors.  In the case of an error, find out what's wrong, maybe a formatting error or unidentified character, and try again.
<p>
Use <b>CARDecode.exe</b> (Windows only) and drag <b>Catalogs.car</b> onto the executable file to decrypt it into <b>Catalogs.zip</b>
<p>
Add the new version of <b>Abilities.cnut</b> to <b>Catalogs.zip</b>, replacing the existing file.  Then use <b>CARDecode.exe</b> to encrypt it back into <b>Catalogs.car</b>.
<p>
Recalculate the MD5 checksum of the new <b>Catalogs.car</b>.  A crude command line program <b>MD5.exe</b> is provided (Windows only) but other programs may be found online.  If using this program, run the following command line:
<span class="script">
md5 Catalogs.car \Release\Current\Media &gt; NewChecksum.txt</span>
<p>
Take the generated hash (from <b>NewChecksum.txt</b> if using the above method) and copy and paste the updated line into <a href="HTTPChecksum.html">Data\HTTPChecksum.txt</a>.
<p>
Restart the server (required for any change to <b>AbilityTable.txt</b> itself).  If only updating the CAR checksums, then alternatively use the Reload Checksum tool in the server's administrative panel.
<p>
Restart the client.  If all steps were correct, it should now download the updated <b>Catalogs.car</b> and will be synchronized with the server.
<p>
Every time you modify <b>AbilityTable.txt</b>, the update procedure must be run again.  It may be helpful to write some command line scripts to help automate this process.
<p>

<div class="spacer"></div>
<h3>Tips For Editing</h3>

This file is best edited by importing into a spreadsheet application like LibreOffice.
Check to make sure what kind of quotation marks your editor program uses!  LibreOffice Calc by default uses different marks for opening and closing quotation marks.  These will not be loaded correctly by the server.  Make sure to use ASCII quotation marks ("") instead.  If necessary, you can do a find and replace to make sure that all are fixed.
<p>
<div class="indent">
Note: The bad quotation marks will look like this:<br>
<span style="font-size:48px">&#8220;Wrong!&#8221;</span><br>
<p>
When instead they should look like this:<br>
<span style="font-size:48px">"Correct"</span><br>
</div>
<p>
Follow established form whenever possible.  Some cells require explicit values like "0" instead of being left blank with "".
<p>
The easiest way to figure out how things work is to look at existing abilities that use whatever behavior you're looking for.  For example, to see how channels work, look at Healing Tendril.  More complex skills like Healing Breeze are useful to examine because it has a casting warmup, channel iterations, active effect, and a secondary channel effect.
<p>
Pay close attention to syntax, punctuation, opening and closing quotes and parenthesis.  They are very important and a small typo or invalid character could easily break the table, or the game client.
<p>


<div class="spacer"></div>
<h3>Data Format</h3>
Table file.  Tab separated values.<br>
Comment character: semicolon (;)<br>
No header.<br>

<table frame=box rules=all>
<tr class="header">
  <td>Index</td>
  <td>Property</td>
  <td>Description</td>
</tr>
<tr>
  <td>0</td>
  <td>Ability ID</td>
  <td>This forms the key of the table entry.  Must be a unique number.</td>
</tr>
<tr>
  <td>1</td>
  <td>Name</td>
  <td>Ability name displayed in the tooltip.</td>
</tr>
<tr>
  <td>2</td>
  <td>Hostility</td>
  <td>Not used by the server.  Not sure if used by the client either.  Common values are -1, 0, or 1.</td>
</tr>
<tr>
  <td>3</td>
  <td>Warmup Time</td>
  <td>Casting warmup time, in milliseconds.  If set, this distinguishes this ability as a warmup, instead of an instant cast.  Example: Healing Hand</td>
</tr>
<tr>
  <td>4</td>
  <td>Warmup Cue</td>
  <td>The client effect script to play during a timed ability cast.  Scripts are packaged in <b>EarthEternal.car</b> in the Effects folder.</td>
</tr>
<tr>
  <td>5</td>
  <td>Duration</td>
  <td>For channels, this is the duration in milliseconds.  If set, this ability is considered a channel.<p>If you want this channel to have special effects, like running in the background or be uninterruptable, refer to the last column: <b>Server Flags</b>.</td>
</tr>
<tr>
  <td>6</td>
  <td>Interval</td>
  <td>For channels, this is the time between iterative effects, in milliseconds.</td>
</tr>
<tr>
  <td>7</td>
  <td>Cooldown Category</td>
  <td>Can be anything.  Any abilities sharing this cooldown category name cannot be used until the cooldown expires.  The actual amount of time depends on the next column.  Note that different abilities may have different cooldown times, even if they share the same cooldown category.</td>
</tr>
<tr>
  <td>8</td>
  <td>Cooldown Time</td>
  <td>Time for the cooldown to expire, in milliseconds.</td>
</tr>
<tr>
  <td>9</td>
  <td>Activation Criteria</td>
  <td>A list of conditions that must be passed before an ability can be casted.<p>
  <span class="script">Function(arg1,arg2)[, ...]</span>
  <p>
  Multiple function arguments are separated by commas.<br>
  Multiple functions are separated by commas.
  </td>
</tr>
<tr>
  <td>10</td>
  <td>Activation Actions</td>
  <td>A list of actions that are performed when the ability is casted.<p>
  <span class="script">onEvent:TargetType(range):Function1(),Function2();onEvent:[...]</span>
  <p>
  onEvent: Refer to the possible <a href="#EventTypes">Event Types</a>.<br>
  TargetType: Refer to the possible <a href="#TargetTypes">Target Types</a>.  Some of them have a range argument in parenthesis, some do not.<br>
  Multiple function arguments are separated by commas.<br>
  Multiple functions are separated by commas.<br>
  Multple events are separated by a semicolon.
  </td>
</tr>
<tr>
  <td>11</td>
  <td>Visual Cue</td>
  <td>The client effect script to play when casted.  This is the name of a scripted event, often specifically programmed for particular abilities, such as animations, projectile and particle effects, glows, auras, etc.  Scripts are packaged in <b>EarthEternal.car</b> in the Effects folder.</td>
</tr>
<tr>
  <td>12</td>
  <td>Tier</td>
  <td>The ability tier.  Typically one of the following values:
  <pre class="script">
  1     =  Level 1
  2     =  Level 6 
  3     =  Level 20
  4     =  Level 30
  5     =  Level 40
  6     =  Level 50
  </pre>
  </td>
</tr>
<tr>
  <td>13</td>
  <td>Prereq</td>
  <td>A list of purchase requirements.  Tier, Ability Cost, Prereq Abilities, etc).  Contains up to 5 requirements, separated by commas, in the following format:<p>
  <pre class="script">Level,CostOtherClass,CostInClass,(Abilities),Classes</pre>
  <p>
  Level: Character level required.<p>
  CostOtherClass: Ability point cost for cross-class skills of a different class.  This value is not used by the server.<p>
  CostInClass: Ability point cost for same-class skills.  This is the actual cost used by the server, for all classes.<p>
  Abilities: A list of Ability IDs that must already be purchased.  Separate multiple abilities with a pipe [ | ].  This entire block is enclosed in parenthesis.<p>
  Classes: A string of characters, where each character denotes a class (<b>K</b>night, <b>R</b>ogue, <b>M</b>age, <b>D</b>ruid).  Often <span class="string">KRMD</span> for all classes, but any combination is possible.  
  <p>
  For example, here is the Prereq entry for the Blazing (mage) cross-class ability.  It is level 20, costs 4 points, requires abilities 379 (Hand of Heraclitus - Tier 3) and 411 (Incinerate - Tier 3), and is open to all classes.
  <pre class="script">20,4,4,(379|411),KRMD</pre>
  </td>
</tr>
<tr>
  <td>14</td>
  <td>Icon</td>
  <td>Icon to display in the ability window, and buff icons.  Either a single image, or two can be combined in the format of: <pre class="script">Foreground|Background</pre></td>
</tr>
<tr>
  <td>15</td>
  <td>Description</td>
  <td>Description displayed in the ability tooltip.  Important!  You must update any skill formulas or numbers here or else the client descriptions will not match the actual values used by the server.  Remember that damage mitigation and randomized damage ranges will produce different numbers in combat, too.  These formulas do not include weapon or element specialization, or other effects.<p>To determine if damage ranges are accurate, it is recommended to test abilities with custom weapons with a min/max damage of the same value (ex: 10-10), without specializations, and against custom enemies with zero physical and elemental armor ratings.  This will most easily allow a damage number in the description to match actual combat damages in game.</td>
</tr>
<tr>
  <td>16</td>
  <td>Category</td>
  <td>Which class/classification tab page this ability is found under.</td>
</tr>
<tr>
  <td>17</td>
  <td>Coordinate X</td>
  <td>Location in the ability window grid.</td>
</tr>
<tr>
  <td>18</td>
  <td>Coordinate Y</td>
  <td>Location in the ability window grid.</td>
</tr>
<tr>
  <td>19</td>
  <td>Group ID</td>
  <td>Very important.  This is what groups different tiers of abilities together, and also serves to prevent multiple buff types from overlapping.  Every distinct ability (for example, all tiers of Bash) should have the same group ID.</td>
</tr>
<tr>
  <td>20</td>
  <td>Ability Class</td>
  <td>Unknown/unused/obsolete in the client.  If set to "Passive", the server will automatically activate this skill for the player when they log in.</td>
</tr>
<tr>
  <td>21</td>
  <td>Use Type</td>
  <td>Unknown/unused/obsolete in the client.  If set to 4, the server will consider this as a passive and will automatically activate this skill for the player when they log in (redundant to Ability Class).</td>
</tr>
<tr>
  <td>22</td>
  <td>Add Melee Charge</td>
  <td>Unknown/unused/obsolete.</td>
</tr>
<tr>
  <td>23</td>
  <td>Add Magic Charge</td>
  <td>Unknown/unused/obsolete.</td>
</tr>
<tr>
  <td>24</td>
  <td>Ownage</td>
  <td>Unknown/unused/obsolete.</td>
</tr>
<tr>
  <td>25</td>
  <td>Gold Cost</td>
  <td>Cost to purchase, in copper.  Presently ignored by the server.</td>
</tr>
<tr>
  <td>26</td>
  <td>Buff Category</td>
  <td>This is required for buff icons to appear in the client.  If this field begins with {+,-,w} then it means Buff, Debuff, or World Buff, respectively.  Not sure if the rest are important, you may need to experiment.  Refer to abilities providing similar effects for reference on how this field is used.  Abilities which require separate buff icons (for example Bounder Dash and a speed potion) may need to have a unique buff name, so keep that in mind too.</td>
</tr>
<tr>
  <td>27</td>
  <td>Target Status</td>
  <td>A restriction of target types to cast on.  Independent from action targets.  Refer to <a href="#TargetFilter">Target Filters</a>.</td>
</tr>
<tr>
  <td>28</td>
  <td>Server Flags</td>
  <td>Optional.  Custom server-side parameters.  Do not include this column in the client table (<b>Abilities.nut</b>).  Multiple options can be combined by separating them with a pipe [ | ].  Does not allow spaces.  Possible flags:<p>
  <span class="script">secondarychannel</span> : Runs an onIterate ability as a secondary passive channel, and will continue to function while the player uses other abilities (for example, bleeding or burning damage).  Only one secondary channel can be active per character.  If a secondary channel is already running, it will be replaced by the new effect.
  <p>
  <span class="script">unbreakablechannel</span> : This channel cannot be interrupted by attacks.
  <p>
  <span class="script">allowdeadstate</span> : Normally players cannot use abilities while dead.  This will bypass that check.
  </td>
</tr>
</table>

<p>

<div class="spacer"></div>
<a name="EventTypes"></a>
<h3>Event Types</h3>
<table frame=box rules=all>
<tr>
  <td>onRequest</td>
  <td>Called when an ability is first requested for activation.  This is responsible for checking the activation criteria and confirming targets.  If there is a warmup time, this will begin the warmup countdown.</td>
</tr>
<tr>
  <td>onActivate</td>
  <td>Called when an ability actually fires.  Assumes all casting conditions have been met.  If there is a warmup time, it has finished.</td>
</tr>
<tr>
  <td>onIterate</td>
  <td>Called during each iteration of a channelled effect.</td>
</tr>
<tr>
  <td>onParry</td>
  <td>Called when a successful parry has been triggered against the target.  This is a special event used for some abilities.  Abilities containing this action will be automatically registered as a potential implicit action to take against an attacker when a parry is successful.  This should only be used for passive abilities.</td>
</tr>
</table>


<div class="spacer"></div>
<a name="TargetTypes"></a>
<h3>Target Types</h3>
<b>Note!</b> Some target types require a distance too (in parenthesis).  10 units of distance equals 1 meter in game.
<p>
<b>Note!</b> Even for target types that support multiple targets, the server is hardcoded with a maximum of 8 targets that can be affected at once.  Ordering is not based on any criteria.  The first targets found when iterating over the zone creature lists will be returning, which will be in a non-specific, undefined order.
<p>
<table frame=box rules=all>
<tr>
  <td>None</td>
  <td>Nothing.</td>
</tr>
<tr>
  <td>Self</td>
  <td>Always affects the caster, even if another target is selected.</td>
</tr>
<tr>
  <td>ST</td>
  <td>Single target, whoever the actor has selected (could be friend or foe, other conditions must determine which are allowed).  Will default to self if no target is selected (if the skill allows).</td>
</tr>
<tr>
  <td>Implicit</td>
  <td>Used with the onParry event type.  This is the action to perform against the actor that has parried an attack.</td>
</tr>
<tr>
  <td>Party(distance)</td>
  <td>Party members within a certain distance of the caster.</td>
</tr>
<tr>
  <td>Cone180(distance)</td>
  <td>Any applicable targets within a 180 degree cone directly in front of the caster.</td>
</tr>
<tr>
  <td>Cone90(distance)</td>
  <td>Any applicable targets within a 90 degree cone directly in front of the caster.</td>
</tr>
<tr>
  <td>GTAE(distance)</td>
  <td>Ground target area-of-effect.  This is for abilities where the caster manually selects a target location (like mage's Frost Storm or druid's Swarm).</td>
</tr>
<tr>
  <td>PBAE(distance)</td>
  <td>Area-of-effect surrounding the caster (like knight's Blender, druid's Nefritari's Aura)</td>
</tr>
<tr>
  <td>STAE(distance)</td>
  <td>Area-of-effect surrounding the target (like mage's Cataclysm)</td>
</tr>
<tr>
  <td>STXAE(distance)</td>
  <td>Area-of-effect surrounding the target, but excludes the target (like mage's Wildfire).</td>
</tr>
<tr>
  <td>STP</td>
  <td>Similar to ST, but is guaranteed to default to self if no target is selected.  Typically only used by the henge abilities.</td>
</tr>
</table>


<div class="spacer"></div>
<a name="TargetFilter"></a>
<h3>Target Filter</h3>
Filters targets based on friend/foe and alive/dead conditions.  Abilities cannot be performed unless at least one target is accepted (up to a maximum of 8 targets).
<p>
<table frame=box rules=all>
<tr>
  <td>Dead</td>
  <td>Target must be dead, no destinction between friend or foe.  Should only be used in very specific cases.</td>
</tr>
<tr>
  <td>Enemy</td>
  <td>Target must be a valid combat enemy, no distinction between dead or alive.  Should only be used in very specific cases.</td>
</tr>
<tr>
  <td>Enemy Alive</td>
  <td>Target must be a valid combat enemy, and alive (example: pretty much any combat ability).</td>
</tr>
<tr>
  <td>Friend</td>
  <td>Target must be friendly (self, party member, other players).  No distinction between dead or alive.  Should only be used in very specific cases.</td>
</tr>
<tr>
  <td>Friend Alive</td>
  <td>Friendly target, must be alive (heals and buffs).</td>
</tr>
<tr>
  <td class="nowrap">Friend Dead</td>
  <td>Friendly target, must be dead (resurrect).</td>
</tr>
</table>


<div class="spacer"></div>
<a name="AbilityFunctions"></a>
<h3>Ability Functions</h3>
A list of all condition and action functions.  Some functions accept parameters, which will be one of the following types:
<p>
Integer: A whole integer, positive or negative (1, -5, etc).<br>
Float: Numbers which may have a decimal point (0.2, -5.0, etc).<br>
String: Text, usually enclosed in double quotation marks.<br>
Evaluation: Evaluates a basic mathematical expression (including some variables) into either an integer or float, depending on the function.  Refer to <a href="#Evaluations">Evaluations</a> for which variables and operations are available.
<p>
<table frame=box rules=all>
<tr class="header">
  <td>Function</td>
  <td>Description, Parameters, Example Use</td>
</tr>
<tr>
  <td>Facing()</td>
  <td>This condition is successful if the caster is facing its target (180 degrees), whether a creature or the center of a GTAE (ground target) location.  Takes no parameters.<p><pre class="script">Facing()</pre></td>
</tr>
<tr>
  <td>InRange(range)</td>
  <td>This condition is successful if the caster is within range of the target creature or GTAE location.<p>Range: float.  Units.  10 units = 1 meter<p><pre class="script">InRange(30.0)</pre></td>
</tr>
<tr>
  <td>NotSilenced()</td>
  <td>This condition is successful if the target is not silenced (does not have the SILENCE status effect.  Takes no parameters.<p><pre class="script">NotSilenced()</pre></td>
</tr>
<tr>
  <td>HasStatus(effect)</td>
  <td>This condition is successful if the target has the required status effect.  Refer to <a href="../DataSets/StatusEffect.html">Status Effects</a>.  The status name should be ALL CAPS.<p><pre class="script">HasStatus(IN_COMBAT)</pre></td>
</tr>
<tr>
  <td>NotStatus(effect)</td>
  <td>This condition is successful if the target does NOT have the required status effect.  Refer to <a href="../DataSets/StatusEffect.html">Status Effects</a>.  The status name should be ALL CAPS.<p><pre class="script">NotStatus(IN_COMBAT)</pre></td>
</tr>
<tr>
  <td>Interrupt()</td>
  <td>Action.  Interrupts the target's casting warmup or channel.  Takes no parameters.<p><pre class="script">Interrupt()</pre></td>
</tr>
<tr>
  <td>Might(amount)</td>
  <td>This condition is successful if the caster has enough Might.  If the ability cast is successful, this amount of Might will be subtracted.<p>Amount: Integer<p><pre class="script">Might(3)</pre></td>
</tr>
<tr>
  <td>Will(amount)</td>
  <td>This condition is successful if the caster has enough Will.  If the ability cast is successful, this amount of Will will be subtracted.<p>Amount: Integer<p><pre class="script">Will(3)</pre></td>
</tr>
<tr>
  <td>MightCharge(min,max)</td>
  <td>This condition is successful if the caster has enough Might charges (at least as much as min).  If the ability cast is successful, as many charges will be subtracted (but no more than max).<p>Min: Integer<p>Max: Integer<p><pre class="script">MightCharge(1,5)</pre></td>
</tr>
<tr>
  <td>WillCharge(min,max)</td>
  <td>This condition is successful if the caster has enough Will charges (at least as much as min).  If the ability cast is successful, as many charges will be subtracted (but no more than max).<p>Min: Integer<p>Max: Integer<p><pre class="script">WillCharge(1,5)</pre></td>
</tr>
<tr>
  <td>A_AddMightCharge(amount)</td>
  <td>Adds a Might charge to the caster (or subtracts if negative).<p>Amount: Integer<p><pre class="script">A_AddMightCharge(1)</pre></td>
</tr>
<tr>
  <td>A_AddWillCharge(amount)</td>
  <td>Adds a Will charge to the caster (or subtracts if negative).<p>Amount: Integer<p><pre class="script">A_AddWillCharge(1)</pre></td>
</tr>
<tr>
  <td>T_AddMightCharge(amount)</td>
  <td>Adds a Might charge to the target (or subtracts if negative).<p>Amount: Evaluates to integer<p><pre class="script">T_AddMightCharge(-2)</pre></td>
</tr>
<tr>
  <td>T_AddWillCharge(amount)</td>
  <td>Adds a Will charge to the target (or subtracts if negative).<p>Amount: Evaluates to integer<p><pre class="script">T_AddWillCharge(-2)</pre></td>
</tr>
<tr>
  <td>StealWillCharge(amount)</td>
  <td>Action.  Not present in the original game.  Removes Will charges from the target and grants them to the caster.  The number of charges removed is based on the target's current charge count, but will not exceed 'amount'.  Must be positive.<p>Amount: Evaluates to integer<p><pre class="script">StealWillCharge(2)</pre></td>
</tr>
<tr>
  <td>StealMightCharge(amount)</td>
  <td>Action.  Not present in the original game.  Removes Might charges from the target and grants them to the caster.  The number of charges removed is based on the target's current charge count, but will not exceed 'amount'.  Must be positive.<p>Amount: Evaluates to integer<p><pre class="script">StealMightCharge(2)</pre></td>
</tr>
<tr>
  <td>FullMight()</td>
  <td>Fully replenishes the target's Might bar to maximum (10 units).  Takes no parameters.<p><pre class="script">FullMight()</pre></td>
</tr>
<tr>
  <td>FullWill()</td>
  <td>Fully replenishes the target's Will bar to maximum (10 units).  Takes no parameters.<p><pre class="script">FullWill()</pre></td>
</tr>
<tr>
  <td>hasMainHandWeapon</td>
  <td>This condition returns true if the caster has a weapon equipped in its main hand.  Always true for NPCs.  Takes no parameters. <p><pre class="script">hasMainHandWeapon</pre></td>
</tr>
<tr>
  <td>hasOffHandWeapon</td>
  <td>This condition returns true if the caster has an offhand weapon equipped.  Always true for NPCs.  Takes no parameters. <p><pre class="script">hasOffHandWeapon</pre></td>
</tr>
<tr>
  <td>hasMeleeWeapon</td>
  <td>This condition returns true if the caster has a melee weapon equipped.  Functionally equivalent to hasMainHandWeapon.  Always true for NPCs.  Takes no parameters. <p><pre class="script">hasMeleeWeapon</pre></td>
</tr>
<tr>
  <td>hasRangedWeapon</td>
  <td>This condition returns true if the caster has a ranged weapon equipped.  Always true for NPCs.  Takes no parameters. <p><pre class="script">hasRangedWeapon</pre></td>
</tr>
<tr>
  <td>hasShield</td>
  <td>This condition is a placeholder and is not implemented.  Takes no parameters.  Always returns true.<p><pre class="script">hasShield</pre></td>
</tr>
<tr>
  <td>hasBow</td>
  <td>This condition returns true if the caster has a bow equipped in its ranged weapon slot.  Always true for NPCs.  Takes no parameters. <p><pre class="script">hasBow</pre></td>
</tr>
<tr>
  <td>has2HorPoleWeapon</td>
  <td>This condition returns true if the caster has a Two-Handed or Pole weapon equipped in its main hand slot.  Always true for NPCs.  Takes no parameters. <p><pre class="script">has2HorPoleWeapon</pre></td>
</tr>
<tr>
  <td>hasWand</td>
  <td>This condition returns true if the caster has a Wand equipped in its ranged weapon slot.  Always true for NPCs.  Takes no parameters. <p><pre class="script">hasWand</pre></td>
</tr>
<tr>
  <td>Status(effect,duration)</td>
  <td>Adds a status effect for the given duration (in seconds).  If the duration is -1, it will not expire.  Refer to <a href="../DataSets/StatusEffect.html">Status Effects</a>.  The status name should be ALL CAPS.<p>Effect: Status effect name.<p>Duration: Evaluation to float.  Seconds.<p><pre class="script">Status(STUN,6)</pre></td>
</tr>
<tr>
  <td>Amp(stat,percent,duration)</td>
  <td>Amplifies a stat by a percentage of its current amount.  Percent is a floating point number, and may be negative.  Duration may be evaluated, but is converted to whole seconds.  Refer to <a href="../DataSets/Stats.html">Character Stats</a>. Only numerical stats can be modified.  The stat name should be ALL CAPS.  Uses the buff category listed in column index[26] (column #27) of the ability entry.<p>Stat: Character stat name<p>Percent: Float<p>Duration: Evaluation to integer.  Seconds<p><pre class="script">Amp(STRENGTH,0.05,3600)</pre></td>
</tr>
<tr>
  <td>Add(stat,amount,duration)</td>
  <td>Modifies a stat by specific amount, which may be either a buff or debuff.  The amount may be evaluated.  Duration may be evaluated, but is converted to whole seconds.  If the duration is -1, it will not expire.  Refer to <a href="../DataSets/Stats.html">Character Stats</a>.  Only numerical stats can be modified.  The stat name should be ALL CAPS.  Uses the buff category listed in column index[26] (column #27) of the ability entry.<p>Stat: Character stat name<p>Amount: Evaluation to float.<p>Duration: Evaluation to integer.  Seconds<pre class="script">Add(SPIRIT,3,3600)</pre></td>
</tr>
<tr>
  <td>AmpCore(percent,duration)</td>
  <td>Amplifies each of the core stats (strength, dexterity, constitution, psyche, spirit) by a percentage of their current amounts.  Percent is a floating point number, and may be negative.  Duration may be evaluated, but is converted to whole seconds.  Uses the buff category listed in column index[26] (column #27) of the ability entry.<p>Percent: Float<p>Duration: Evaluates to integer.  Seconds.<p><pre class="script">AmpCore(-0.06,60)</pre></td>
</tr>
<tr>
  <td>Nullify(stat,duration)</td>
  <td>Negates a stat by adding a debuff for the inverse of its current value.  (N + (-N) = 0).  Operates on the current value only, does not take into account any other buffs that may be active.  For example, if the stat changes while Nullify() is still active, the sum total of all active buff amounts would no longer equal zero.  Duration may be evaluated, but is converted to whole seconds.  Refer to <a href="../DataSets/Stats.html">Character Stats</a>.  Only numerical stats can be modified.  The stat name should be ALL CAPS.  Uses the buff category listed in column index[26] (column #27) of the ability entry.<p>Stat: Stat name.<p>Duration: Evaluates to integer.  Seconds.<p><pre class="script">Nullify(WILL_REGEN,(3*willCharges))</pre></td>
</tr>
<tr>
  <td>CheckBuffLimits(level,buffcategory)</td>
  <td>Unused.  The condition is not emulated and always returns true.  In the original game this served to prevent  abilities from functioning if a stronger buff was active.  In some cases this introduced bugs where certain buffs or even attacks could not be used in some situations.  The server automatically handles buff effects by denying weaker tier buffs if a stronger tier version of that ability has been casted.  However, this may produce a potentially unwanted side effect where buffs or debuffs from different abilities may stack.<p>Level: Integer<p>buffcategory: Buff category name.<p><pre class="script">CheckBuffLimits(20,+/BuffMove/Buff:Run Speed)</pre></td>
</tr>
<tr>
  <td>MeleeDamage(amount)</td>
  <td>Applies physical damage.  This function will not work if the caster has the DISARM status effect.  The amount is evaluated.  The calculated result will automatically include bonuses from the dmg_mod_melee stat, hit chance and damage reduction, and critical hit amplification if applicable.  Also calculates damage reduction from the target's armor, and can be fully negated by the target's dodge/block/parry chances, if successful.  Note: each call to MeleeDamage() rolls dodge/block/parry chances, so using the function multiple times might increase the chances that the final result will be negated.<p>Amount: Evaluates to integer<p><pre class="script">MeleeDamage((A_STRENGTH*0.112+6)*1)</pre></td>
</tr>
<tr>
  <td>FireDamage(amount)</td>
  <td>Applies fire damage.  The final result will automatically include bonuses from the caster's  appropriate elemental specialization, and also the target's damage reduction for that element.<p>Amount: Evaluates to integer<p><pre class="script">FireDamage(((A_PSYCHE*1.35+32)*1)*0.65)</pre></td>
</tr>
<tr>
  <td>FrostDamage(amount)</td>
  <td>...</td>
</tr>
<tr>
  <td>MysticDamage(amount)</td>
  <td>...</td>
</tr>
<tr>
  <td>DeathDamage(amount)</td>
  <td>...</td>
</tr>
<tr>
  <td>Heal(amount)</td>
  <td>Heals the target.  Automatically includes bonuses from the caster's healing specialization.<p>  Amount: Evaluation to integer.  Hitpoints to heal.<p><pre class="script">Heal((A_SPIRIT*2.1448+20)/8)</pre></td>
</tr>
<tr>
  <td>A_Heal(amount)</td>
  <td>Heals the caster.  Automatically includes healing specialization.<p>Amount: Evaluation to integer.  Hitpoints to heal.<p><pre class="script">A_Heal(((A_SPIRIT*1.792+131)*1.2)/5)</pre></td>
</tr>
<tr>
  <td>Harm(amount)</td>
  <td>Deals direct hitpoint damage to the target.  This amount is not affected by specialization or armor.  Cannot achieve critical hit.  Not subject to block/parry/dodge.<p>Amount: Evaluation to integer.  Hitpoint damage to deal.<p><pre class="script">Harm(MAX_HEALTH*0.25)</pre></td>
</tr>
<tr>
  <td>PercentMaxHealth(ratio)</td>
  <td>This condition is passed if the caster has enough health, based on the ratio of current health to maximum.  The ratio should be between 0.0 and 1.0<p>Ratio: floating point<p><pre class="script">PercentMaxHealth(0.251)</pre></td>
</tr>
<tr>
  <td>Regenerate(amount)</td>
  <td>Heals the target for a flat amount.  Not affected by healing specialization.  This only seems to be used for some potions in the official ability table.  Typically Heal() is used instead.<p>Amount: Evaluation to integer.<p><pre class="script">Regenerate(8)</pre></td>
</tr>
<tr>
  <td>AttackMelee(amount)</td>
  <td>Performs a melee autoattack.  Autoattacks are hardcoded and should not be used directly through the ability table.<p><pre class="script">AttackMelee(0)</pre></td>
</tr>
<tr>
  <td>AttackRanged(amount)</td>
  <td>Performs a ranged autoattack.  Autoattacks are hardcoded and should not be used directly through the ability table.<p><pre class="script">AttackRanged(0)</pre></td>
</tr>
<tr>
  <td>Taunt(duration)</td>
  <td>Taunts the target to attack the caster, by forcing the target to select the caster.  If the target is an NPC, it will hold its target for the specified duration even if another player has generated more hate.<p>Duration: Integer, time in seconds.<p><pre class="script">Taunt(4)</pre></td>
</tr>
<tr>
  <td>AddHate(amount)</td>
  <td>The target will gain a specific amount of hate toward the caster.  Hate is normally generated by attacks, based on damage ((Adjusted Damage / MaxHealth) * 100).  NPCs will target the most hated player for attack.  Only works against NPCs.<p>Amount: Integer<p><pre class="script">AddHate(200)</pre></td>
</tr>
<tr>
  <td>TopHated(amount)</td>
  <td>Unknown.  Not implemented.  Only officially used in the Frost Mire skill, but there is no mention in the skill description of altering creature hate.<p>Amount: Integer<p><pre class="script">TopHated(10)</pre></td>
</tr>
<tr>
  <td>UnHate()</td>
  <td>Any hate generated by the caster is removed from all creatures in the instance, effectively returning to neutral status.  This will not prevent re-aggro if the player is still within range of the creature.<p><pre class="script">UnHate()</pre></td>
</tr>
<tr>
  <td>LeaveCombat()</td>
  <td>Shuts off the caster's autoattack and disables its combat flags (IN_COMBAT, IN_COMBAT_STAND).  This does not remove hate or affect other creatures in any way.<p><pre class="script">LeaveCombat()</pre></td>
</tr>
<tr>
  <td>Behind</td>
  <td>This condition is successful if the caster is behind its target.  For the purposes of this calculation, behind means outside the target's 180 degree forward view cone.<p><pre class="script">Behind</pre></td>
</tr>
<tr>
  <td>Spin()</td>
  <td>Rotates the target's current directional facing by 180 degrees.  This may be somewhat erratic in the client, especially on players since the client does not seem to accept forced player rotations.  Creature AI immediately turns to face their target on the next frame, so this may not be very effective against the target unless it can be stunned or dazed too.<p><pre class="script">Spin()</pre></td>
</tr>
<tr>
  <td>Duration(time)</td>
  <td>Increases the duration of channel effects to match the specified time.  The resulting time will be automatically constrained to fit within a limit of 1 to 32 seconds.<p>Time: Evaluation to integer.  Seconds.<p><pre class="script">Duration(mightCharges*5)</pre></td>
</tr>
<tr>
  <td>Resurrect(healthRatio,luckRatio)</td>
  <td>Resurrect the target with the given health and luck ratios. (1.0 = 100%).  If luckRatio is not provided, it defaults to maximum.<p>healthRatio: float<p>luckRatio (optional): float<p><pre class="script">Resurrect(0.4, 1)</pre></td>
</tr>
<tr>
  <td>NearbySanctuary</td>
  <td>This condition is successful if the caster is within range (25 meters) of a sanctuary.<p><pre class="script">NearbySanctuary</pre></td>
</tr>
<tr>
  <td>BindTranslocate()</td>
  <td>Binds the caster to the nearest sanctuary.<p><pre class="script">BindTranslocate()</pre></td>
</tr>
<tr>
  <td>Translocate()</td>
  <td>Warp the caster to their bound sanctuary.<p><pre class="script">Translocate()</pre></td>
</tr>
<tr>
  <td>PortalRequest(internalName,destinationName)</td>
  <td>Sends a portal request to the target.  Typically used by the stonehenge abilities.  Ensure that an <a href="InteractDef.html">InteractDef</a> entry is supplied for the destination.  The InteractDef's Message field must match destinationName exactly.<p>internalName: string.  Unused.<p>destinationName: string.  Destination.<p><pre class="script">PortalRequest("Transport_Stonehenge", "Stonehenge")</pre></td>
</tr>
<tr>
  <td>Go(destination)</td>
  <td>Unused.  Not implemented.  Teleports the caster to a named location.<p>destination: string<p><pre class="script">Go("LOC5")</pre></td>
</tr>
<tr>
  <td>GoSanctuary()</td>
  <td>Teleports the target to the nearest sanctuary.  Usually called for the caster, but can be used for party members too like the Exodus skill.<p><pre class="script">GoSanctuary()</pre></td>
</tr>
<tr>
  <td>RemoveAltDebuff()</td>
  <td>Removes one of the following debuffs from the target: Negative amount stat modifiers for {MELEE_ATTACK_SPEED, MAGIC_ATTACK_SPEED, MOD_MOVEMENT}, and status effects {FEAR, CHARM, ROOT} in that order.  Refer to the Free ability.<p><pre class="script">RemoveAltDebuff()</pre></td>
</tr>
<tr>
  <td>RemoveStatDebuff()</td>
  <td>Removes one of the following debuffs from the target: Negative amount stat modifiers for {STRENGTH, DEXTERITY, CONSTITUTION, PSYCHE, SPIRIT, MOD_LUCK} in that order.  Refer to the Cleanse ability.<p><pre class="script">RemoveStatDebuff()</pre></td>
</tr>
<tr>
  <td>RemoveEtcDebuff()</td>
  <td>Removes one of the following debuffs from the target: Negative amount stat modifiers for {BASE_DAMAGE_FIRE, BASE_DAMAGE_FROST, BASE_DAMAGE_MYSTIC, BASE_DAMAGE_DEATH, DAMAGE_RESIST_MELEE, DAMAGE_RESIST_FIRE, DAMAGE_RESIST_FROST, DAMAGE_RESIST_MYSTIC, DAMAGE_RESIST_DEATH, BASE_HEALTH} in that order.  Refer to the Purge ability.<p><pre class="script">RemoveEtcDebuff()</pre></td>
</tr>
<tr>
  <td>RemoveAltBuff()</td>
  <td>Removes one of the following buffs from the target: Positive amount stat modifiers for {MELEE_ATTACK_SPEED, MAGIC_ATTACK_SPEED, MOD_MOVEMENT}.  Refer to the Suppress ability.<p><pre class="script">RemoveAltBuff()</pre></td>
</tr>
<tr>
  <td>RemoveStatBuff()</td>
  <td>Removes one of the following buffs from the target: Positive amount stat modifiers for {STRENGTH, DEXTERITY, CONSTITUTION, PSYCHE, SPIRIT, MOD_LUCK}.  Refer to the Corrupt ability.<p><pre class="script">RemoveStatBuff()</pre></td>
</tr>
<tr>
  <td>RemoveEtcBuff()</td>
  <td>Removes one of the following buffs from the target: Positive amount stat modifiers for {BASE_DAMAGE_FIRE, BASE_DAMAGE_FROST, BASE_DAMAGE_MYSTIC, BASE_DAMAGE_DEATH, DAMAGE_RESIST_MELEE, DAMAGE_RESIST_FIRE, DAMAGE_RESIST_FROST, DAMAGE_RESIST_MYSTIC, DAMAGE_RESIST_DEATH, BASE_HEALTH}.  Refer to the Abolish ability.<p><pre class="script">RemoveEtcBuff()</pre></td>
</tr>
<tr>
  <td>Invisible(duration,distance,unknown</td>
  <td>Activate Mage invisibility.  Travel distance regeneration (when idle) is based on Psyche.<p>Duration: Evaluates to integer.  Seconds.<p>Distance: Evaluates to integer.  Distance units (10 = 1 meter)<p>Unknown: Evaluates to integer.  Not used.<p><pre class="script">Invisible(120,A_PSYCHE*1,0)</pre></td>
</tr>
<tr>
  <td>WalkInShadows(duration,distance)</td>
  <td>Activate Rogue invisibility.  Travel distance regeneration (when idle) is based on Dexterity.<p>Duration: Evaluates to integer.  Seconds.<p>Distance: Evaluates to integer.  Distance units (10 = 1 meter)<p><pre class="script">WalkInShadows(120,A_DEXTERITY*1.0)</pre></td>
</tr>
<tr>
  <td>AddWDesc(stat,iteration,time,desc)</td>
  <td>Not implemented.  Probably had some effect in the client when describing iterative damage from channel ability.  The description in the client's ingoing/outgoing damage filter seems be fine without this.<p>Stat: Stat name.  Refer to <a href="../DataSets/Stats.html">Character Stats</a><p>Iteration: Evaluates to integer.  Seconds between interations?<p>Time: Evalutes to integer.  Maximum duration of channel (seconds)?<p>Desc: String.  Alternate text to display?<p><pre class="script">AddWDesc(BLEEDING,1,8,"Shadow Strike")</pre></td>
</tr>
<tr>
  <td>HealthSacrifice(amount)</td>
  <td>Transfers hitpoints from the caster to the target.  Health will not transfer if the target is at maximum HP.  Only transfers as much health as the target needs, up to the specified amount.  The caster will be damaged and lose HP equivalent to the transfer amount.  The caster will die if they do not have enough HP to withstand the damage.<p>Amount: Evalutes to integer.  Hitpoints.<p><pre class="script">HealthSacrifice(150)</pre></td>
</tr>
<tr>
  <td>DoNothing()</td>
  <td>Placeholder function.  As the name implies, it doesn't do anything<p><pre class="script">DoNothing()</pre></td>
</tr>
<tr>
  <td>Reagent(itemID,count)</td>
  <td>Not implemented.  This condition is passed if the player has enough items in their inventory, and consumes them if the ability successfully activates.  This function was never implemented server-side because reagents were usually an unnecessary, stupid requirement.  Always returns successful.<p>itemID: Integer, ItemDef mID.<p>count: Integer, number of items.<p><pre class="script">Reagent(20522,2)</pre></td>
</tr>
<tr>
  <td>SetAutoAttack(effect)</td>
  <td>Custom, unofficial function.  Don't use this in the ability table.  The function exists for internal server use only.  Effect corresponds to AUTO_ATTACK or AUTO_ATTACK_RANGED.</td>
</tr>
<tr>
  <td>DisplayEffect(name)</td>
  <td>Custom, unofficial function.  Performs a visual effect.  This can be used to simulate visual effects in cases when particular abilities are not scripted.  For example, a custom ability that launches a fireball against multiple targets.  The effect name must exist in the client's ability effect scripting.  Not to be confused with status effects.<p>Name: String.  Effect name.<p><pre class="script">DisplayEffect("Firebolt")</pre></td>
</tr>
<tr>
  <td>InterruptChance(amount)</td>
  <td>Custom, unofficial function.  Modifies the interrupt chance of a channel performed by this ability.  Internally the amount is considered as an additive bonus to CHANNELING_BREAK_CHANCE but does not alter the stat itself, and therefore does not affect the interrupt chance of other abilities.<p>Amount: Evaluates to integer.  10 units = 1% chance.<p><pre class="script">InterruptChance(-150)</pre></td>
</tr>
</table>

<div class="spacer"></div>
<a name="OtherNotes"></a>
<h3>Other Notes</h3>
These are some advanced points of interest for how some of the values are loaded from the table.
<p>
Skills that use MeleeDamage() are flagged as dealing physical damage.  Skills that use FireDamage(), FrostDamage(), MysticDamage(), or DeathDamage() are flagged as dealing magic damage.  Skills that are only flagged for physical (and not magic) are subject to the DISARM status effect and may prevent the caster from using the ability (if CustomAbilityMechanics is enabled, see <a href="../ServerConfig.html">ServerConfig.txt</a>).
<p>
Skills default to instant cast.  If the "Warmup Time" column value is greater than zero, the ability is a timed cast instead.
<p>
If the "Duration" column value is set to nonzero, the ability is considered a channel.
<p>
If the "Ability Class" column value is set to "Passive" OR the "Use Type" column value is set to 4, then the ability is considered a passive.  Passive abilities are activated when a player logs in.
<p>
Skills that contain the onParry event are registered to the creature for implicit response actions when a parry is successful.  Logically these should be activated as passives, since implicit events are effectively permanent and are not removed except for a relog or respec.
<p>
Concerning the client-side ability Description: <span class="string">A_STRENGTH</span> and similar prefixed names seem to have a special case when used in the client.  Anything following the <span class="string">A_</span> is interpreted as a <a href="../DataSets/Stats.html">Character Stat</a> name and can be used to display information from the caster.  If you're reading an ability tooltip, it's from the player's avatar stats.  <span class="string">T_</span> stats have not been tested in the description field.

<div class="spacer"></div>
<a name="Evaluations"></a>
<h3>Evaluations</h3>
Any function parameter that is mentioned as evaluating to a float or integer will be processed as a simple expression.  Expressions may contain parenthesis and basic mathematical operations: addition, subtraction, multiplication, division, and modulo division.  <span class="script">( + - * / % )</span> .  Watch out for divide by zero (which will fail out a particular term with a zero value instead).  If using a variable or character stat, think if there's any possibility that it might be zero.
<p>
Order of operations has not been fully tested, so if it's producing incorrect results, you may need to explicitly define them with parenthesis.
<p>
Expression may also allow the following variables which will be substituted during the evaluation process.
Note: Case Sensitive!<p>
<pre class="script">
A_STRENGTH         Caster's STRENGTH property.
A_DEXTERITY        Caster's DEXTERITY property.
A_SPIRIT           Caster's SPIRIT property.
A_PSYCHE           Caster's PSYCHE property.
A_CONSTITUTION     Caster's CONSTITUTION property.
A_LEVEL            Caster's LEVEL property (character level).
mightCharges       The number of might charges spent casting this ability.  Some abilities don't use all charges.
willCharges        The number of will charges spent casting this ability.  Some abilities don't use all charges.
MWD                Calculates melee weapon damage[*]. Mainhand + Offhand (if applicable).
RWD                Calculates ranged weapon damage[*].
WMD                Calculates melee weapon damage[*]. Does not include offhand.
MAX_HEALTH         The caster's max health.
damage             Intended for implicit actions only (parries), returns the parried damage.
</pre>
Notes:<br>
[*] These damage calculations include: Weapon item damage (from min/max), Strength bonus (30% of current strength added to damage points), Weapon Specialization, and the "base_damage_melee" stat (often used by NPCs since they don't have actual weapons).  Offhand damage applies to rogues only, and includes offhand mastery percentage.  These calculations are physical damage only, and are used as the base amount for autoattacks and many physical abilities.  They do not include elemental bonuses to auto attacks.

<p>The following properties are new custom features in the server:
<p>
<pre class="script">
T_mightCharges        The target's current might charges.
T_willCharges         The target's current will charges.
mightChargesCurrent   The caster's current might charges.
willChargesCurrent    The caster's current will charges.  
</pre>


<div class="footer"></div>



</div>
</body>
</html>